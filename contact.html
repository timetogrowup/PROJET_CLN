<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact — CLN</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="navbar">
        <a class="brand" href="index.html">
          <img src="LOGO_CLN.png" alt="Logo CLN" />
          <span>CLN · Solutions intelligentes</span>
        </a>
        <nav class="nav-links">
          <a href="index.html">Accueil</a>
          <a href="solutions.html">Solutions</a>
          <a href="approche.html">Notre approche</a>
          <a href="realisations.html">Réalisations</a>
          <a href="diagnostic.html">Diagnostic</a>
          <a class="active" href="contact.html">Contact</a>
        </nav>
        <a class="cta-button" href="contact.html">Être recontacté</a>
      </div>
    </header>
    <main>
      <section>
        <h1 class="section-title">Parlons de vos projets</h1>
        <p class="section-lead">
          Décrivez-nous votre contexte et nous reviendrons vers vous sous 48 heures. Nous étudierons avec vous comment connecter, libérer et normaliser vos systèmes d'information.
        </p>
      </section>

      <section class="contact-grid">
        <div>
          <div id="recommendation-preview" class="result-card recommendation-card" hidden>
            <div class="recommendation-header">
              <h2>Votre recommandation CLN</h2>
              <button type="button" class="link-button" id="recommendation-clear">Effacer</button>
            </div>
            <p class="recommendation-meta" id="recommendation-date"></p>
            <div id="recommendation-content"></div>
            <p class="recommendation-note">
              Ajoutez ces éléments à votre message pour que notre équipe prépare un échange ciblé.
            </p>
          </div>
          <h2>Nous contacter</h2>
          <p>
            CLN accompagne les organisations publiques et privées sur leurs enjeux data, automatisation et gouvernance.
          </p>
          <ul>
            <li>Email : <a href="mailto:patrick.lyonnet@cln-solutions.fr">patrick.lyonnet@cln-solutions.fr</a></li>
            <li>Téléphone : <a href="tel:+33700000000">+33 7 00 00 00 00</a></li>
            <li>LinkedIn : <a href="#">@CLN-Solutions</a></li>
          </ul>
          <p>
            Vous préférez fixer un créneau ? Proposez deux disponibilités et nous vous envoyons une invitation.
          </p>
        </div>
        <div>
          <form id="contact-form" action="contact.php" method="POST" novalidate>
            <div id="form-alert" class="form-alert" hidden></div>
            <label for="name">Nom et prénom</label>
            <input id="name" name="name" type="text" placeholder="Marie Dupont" required />

            <label for="email">Email professionnel</label>
            <input id="email" name="_replyto" type="email" placeholder="marie.dupont@organisation.fr" required />

            <label for="company">Organisation</label>
            <input id="company" name="company" type="text" placeholder="Organisation / Collectivité" />

            <label for="message">Votre besoin</label>
            <textarea id="message" name="message" rows="5" placeholder="Décrivez votre projet ou vos problématiques."></textarea>

            <label class="checkbox">
              <input type="checkbox" name="consent" required />
              J'accepte que CLN me contacte au sujet de ma demande.
            </label>

            <button class="cta-button" type="submit">Envoyer la demande</button>
          </form>
        </div>
      </section>
    </main>
    <footer>
      <div class="footer-inner">
        <span>© CLN — Solutions intelligentes pour vos SI.</span>
        <div class="footer-links">
          <a href="mailto:patrick.lyonnet@cln-solutions.fr">patrick.lyonnet@cln-solutions.fr</a>
          <a href="contact.html">Prendre rendez-vous</a>
          <a href="#">Mentions légales</a>
        </div>
      </div>
    </footer>
    <script>
      (function () {
        const container = document.getElementById('recommendation-preview');
        const content = document.getElementById('recommendation-content');
        const clearBtn = document.getElementById('recommendation-clear');
        const dateLabel = document.getElementById('recommendation-date');
        const messageField = document.getElementById('message');

        if (!container || !content) {
          return;
        }

        let raw;
        try {
          raw = localStorage.getItem('clnRecommendation');
        } catch (error) {
          return;
        }

        if (!raw) {
          return;
        }

        let data;
        try {
          data = JSON.parse(raw);
        } catch (error) {
          return;
        }

        if (!data || !data.html) {
          return;
        }

        content.innerHTML = data.html;
        if (dateLabel && data.generatedAt) {
          const generated = new Date(data.generatedAt);
          if (!Number.isNaN(generated.getTime())) {
            const formatted = generated.toLocaleString('fr-FR', {
              day: '2-digit',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
            dateLabel.textContent = `Synthèse générée le ${formatted}.`;
          }
        }

        let prefillText = '';
        if (messageField && !messageField.value && data.meta) {
          const lines = [
            data.meta.organisationLine,
            data.meta.moduleSummary,
            data.meta.prioritySummary,
            data.meta.recommendationLine,
            data.meta.nextStepLine
          ]
            .filter(Boolean)
            .join('\n');
          if (lines) {
            prefillText = `${lines}\n\nPouvez-vous me proposer un créneau pour approfondir ?`;
            messageField.value = prefillText;
            messageField.dataset.prefilledRecommendation = 'true';
          }
        }

        container.hidden = false;

        if (clearBtn) {
          clearBtn.addEventListener('click', (event) => {
            event.preventDefault();
            try {
              localStorage.removeItem('clnRecommendation');
            } catch (error) {
              /* noop */
            }
            if (messageField && messageField.dataset.prefilledRecommendation === 'true') {
              const current = messageField.value.trim();
              if (!current || current === prefillText.trim()) {
                messageField.value = '';
              }
              delete messageField.dataset.prefilledRecommendation;
            }
            if (dateLabel) {
              dateLabel.textContent = '';
            }
            content.innerHTML = '<p class="recommendation-note">Recommandation effacée. Générez-en une nouvelle depuis le diagnostic.</p>';
            container.setAttribute('data-cleared', 'true');
            setTimeout(() => {
              container.hidden = true;
              container.removeAttribute('data-cleared');
              content.innerHTML = '';
            }, 1200);
          });
        }
      })();

      (function () {
        const alertBox = document.getElementById('form-alert');
        if (!alertBox) {
          return;
        }

        const params = new URLSearchParams(window.location.search);
        const status = params.get('status');
        if (!status) {
          return;
        }

        let message = '';
        let variant = '';

        switch (status) {
          case 'success':
            message = 'Merci ! Votre message a bien été envoyé. Nous revenons vers vous sous 48 heures.';
            variant = 'form-alert--success';
            break;
          case 'invalid':
            message = 'Certaines informations obligatoires sont manquantes ou invalides. Merci de vérifier les champs requis.';
            variant = 'form-alert--error';
            break;
          case 'error':
            message = 'Une erreur est survenue lors de l’envoi du message. Veuillez réessayer ou contactez-nous directement par email.';
            variant = 'form-alert--error';
            break;
          default:
            return;
        }

        alertBox.textContent = message;
        alertBox.classList.add(variant);
        alertBox.hidden = false;
      })();
    </script>
  </body>
</html>
